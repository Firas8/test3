name: Deployment Action

on:
  push:
    branches: [ "test" ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    environment: DEV
    steps:
      - name: Checkout Project
        uses: actions/checkout@v2
        with:
          token: ${{ env.PAT }}
          fetch-depth: '0'
        env:
          PAT: ${{ secrets.CI_PAT }}
      - run: cd ..
      - run: pwd

      - name: Set up SSH
        run: |
          mkdir -p ~/.ssh/
          echo "$SSH_PRIVATE_KEY" > ./deploy.key
          sudo chmod 600 ./deploy.key
          echo "$SSH_KNOWN_HOSTS" > ~/.ssh/known_hosts
        shell: bash
        env:
          SSH_PRIVATE_KEY: ${{secrets.SSH_PRIVATE_KEY}}
          SSH_KNOWN_HOSTS: ${{secrets.SSH_KNOWN_HOSTS}}

      - name: Install NPM dependencies
        run: npm install

      - name: Build project
        run: npm run build --if-present

      - name: Deploy with rsync
        run: ls -l
       # run: rsync -avz -e "ssh -p 22" . firas.gabsi@34.76.116.221:/data/zento/
