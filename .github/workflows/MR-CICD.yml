name: Deployment Action

on:
  push:
    branches: [ "test" ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    environment: DEV
    steps:
      - name: Checkout Project
        uses: actions/checkout@v2
        with:
          token: ${{ env.PAT }}
          fetch-depth: '0'
        env:
          PAT: ${{ secrets.CI_PAT }}

      - name: Install SSH Key
        uses: shimataro/ssh-key-action@v2
        with:
          key: ${{ env.SSH_PRIVATE_KEY }}
          name: firas.gabsi
          known_hosts: 34.76.116.221
        env:
          SSH_PRIVATE_KEY: ${{secrets.SSH_PRIVATE_KEY}}

      - name: Copy folder content recursively to remote
        uses: garygrossgarten/github-action-scp@release
        with:
          local: /home/runner/work/test3/
          remote: /tmp/zento/
          host: 34.76.116.221
          username: firas.gabsi
          privateKey: ${{ env.SSH_PRIVATE_KEY }}
        env:
          SSH_PRIVATE_KEY: ${{secrets.SSH_PRIVATE_KEY}}
          SSH_KNOWN_HOSTS: ${{secrets.SSH_KNOWN_HOSTS}}

      #- name: executing remote ssh commands using password
        #  uses: appleboy/ssh-action@v0.1.7
          #with:
          #host: 34.76.116.221
          #username: firas.gabsi
          #key: ${{ env.SSH_PRIVATE_KEY }}
          #port: 22
            #script: |
            #sudo su -
            #cd /data/zento
          #./biossunRunner.sh &>/dev/null &
          #env:
          #SSH_PRIVATE_KEY: ${{secrets.SSH_PRIVATE_KEY}}
          #SSH_KNOWN_HOSTS: ${{secrets.SSH_KNOWN_HOSTS}}