name: Deployment Action

on:
  push:
    branches: [ "test" ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    environment: DEV
    steps:
      - name: Checkout Project
        uses: actions/checkout@v2
        with:
          token: ${{ env.PAT }}
          fetch-depth: '0'
        env:
          PAT: ${{ secrets.CI_PAT }}

      - name: Install SSH Key
        uses: shimataro/ssh-key-action@v2
        with:
          key: ${{ env.SSH_PRIVATE_KEY }}
          name: firas.gabsi
          known_hosts: 34.76.116.221
        env:
          SSH_PRIVATE_KEY: ${{secrets.SSH_PRIVATE_KEY}}

        #- name: Post Deploy
        #uses: appleboy/ssh-action@master
          #with:
          #host: ${{ secrets.SSH_KNOWN_HOSTS }}
          #username: firas.gabsi
          #key: ${{ secrets.SSH_PRIVATE_KEY }}
          #port: 22
            #script: |
          #ls -l

      - run: ping 34.76.116.221

      - name: Copy folder content recursively to remote
        uses: garygrossgarten/github-action-scp@release
        with:
          local: /home/runner/work/test3/
          remote: /data/zento/
          host: 34.76.116.221
          username: firas.gabsi
          privateKey: ${{ env.SSH_PRIVATE_KEY }}
        env:
          SSH_PRIVATE_KEY: ${{secrets.SSH_PRIVATE_KEY}}
          SSH_KNOWN_HOSTS: ${{secrets.SSH_KNOWN_HOSTS}}

          #- name: Set up SSH
          #  run: |
          #mkdir -p ~/.ssh/
          #echo ${{ env.SSH_PRIVATE_KEY }} > ./deploy.key
          #sudo chmod 600 ./deploy.key
          #echo ${{ env.SSH_KNOWN_HOSTS }} > ~/.ssh/known_hosts
        #shell: bash
          #env:
          #SSH_PRIVATE_KEY: ${{secrets.SSH_PRIVATE_KEY}}
          #SSH_KNOWN_HOSTS: ${{secrets.SSH_KNOWN_HOSTS}}

        #- name: Install NPM dependencies
        #run: npm install

        #- name: Build project
        #run: npm run build --if-present

        #- name: Deploy with rsync
        #run: rsync -avz -e "ssh -p 22" /home/runner/work/test3/test3 firas.gabsi@34.76.116.221:/data/zento/
