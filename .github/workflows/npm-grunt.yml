name: Project Delivery CI/CI

on:
  push:
    branches: [ "main" ]

jobs:
  Test:
    name: ðŸ› Release
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@master

      - run: echo "CURRENT_VERSION=$(grep version package2.json | awk -F \" '{print $4}')" >> $GITHUB_ENV
      - run: echo ${{ env.CURRENT_VERSION }}

      - run: echo "CURRENT_DATE=$(grep date package2.json | awk -F \" '{print $4}')" >> $GITHUB_ENV
      - run: echo ${{ env.CURRENT_DATE }}

      - run: echo "TEMP=$(echo ${{env.CURRENT_VERSION}} | grep -o -E '[0-9]+' | head -1 | sed -e 's/^0\+//')" >> $GITHUB_ENV
      - name: run number with offset
        env:
          ACTIONS_ALLOW_UNSECURE_COMMANDS: 'true'
        run: |
          echo ::set-env name=NEXT_VERSION=::$((TEMP+1))
      - run: echo $NEXT_VERSION'.0.0'

      - name: Find and Replace
        uses: jacobtomlinson/gha-find-replace@v2
        with:
          find: ${{ env.CURRENT_VERSION }}
          replace: $NEXT_VERSION.0.0
          include: "package2.json"
          regex: false


      - run: git config --global user.email "firas.gabsi@gmail.com"
      - run: git config --global user.name "GABSI"
      - run: git add .
      - run: git commit -m "Release "$NEXT_VERSION".0.0"
      - run: git push

      - run: echo $(date +'%m/%d/%Y')
